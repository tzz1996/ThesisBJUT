\begin{APP}
UEFI文件系统协议栈作为UEFI系统环境中和硬盘设备硬件之间的桥梁，是一个保证硬盘ESP分区中数据信息不被从固件层面
攻击的关键环节。UEFI文件系统协议栈在负责BIOS系统与硬盘设备间进行数据交互的同时，也作为一个UEFI系统启动中DXE
阶段的一些驱动程序的形式进行向系统中的集成与加载。由于硬盘ESP分区中数据文件的重要性，以及近年来越来越多的硬件
攻击手段的出现，不仅有针对硬盘设备的攻击也存在针对固件芯片的攻击，基于这种情况，本为设计了基于UEFI的硬盘文件
安全加载的策略，在一定程度上保证了计算机通过UEFI BIOS和硬盘设备启动过程中的安全性。本文的主要工作内容总结归纳
如下：
\par 1.对UEFI系统启动阶段和UEFI文件系统协议栈相关驱动进行研究，分析目前基于UEFI系统的服务器在通过硬盘ESP
分区中操作系统引导文件启动的加载过程中的安全漏洞，即硬盘设备和固件芯片设备两个可被攻击的对象，结合可信计算
思想，提出了服务器计算机安全加载硬盘文件的策略。
\par 2.安全方案中驱动度量模块的设计。驱动度量模块设计为DXE阶段的可信度量驱动中的一个内容，他是负责在所有
DXE调度程序加载的驱动中检索出文件系统协议栈相关的驱动程序的关键，他通过GUID的方式筛选出需要度量的特定驱动，
以达到自定义度量驱动程序的目的。度量模块是整个可信驱动的关键部分，由他来调度度量值计算模块和基准值取出功能，
最终形成一个可信度量的结果。其中还包括了申威平台特有的向BMC写入日志信息的过程，作为可信度量驱动中日志形成
的实现方法。由于PEI阶段和DXE阶段的系统函数不同，而可信度量驱动都需要进行系统调用，因此设计两个阶段单独的
度量驱动以供安全方案使用。由于需要在被度量驱动前先加载可信度量驱动，因此存在DXE阶段调度程序加载驱动顺序的
问题，通过UEFI中的依赖表达式来完成这一要求，保证度量过程的可实施性。
\par 3.UEFI可信启动信任链的设计。信任链的设计与实现是最终在BDS阶段UEFI系统能安全加载硬盘文件的基础，他从
SEC阶段起始，通过设计的BMC可信平台模块来代替传统TPM模块进行信任链的传递。SEC、PEI、DXE、BDS阶段分别设计
使他们度量下一阶段的核心代码，并根据每个阶段的流程特点，制定出具体的驱动加载和度量方法。其中SEC和PEI阶段
作为开始和中间阶段，由DXE和BDS阶段分别负责UEFI文件系统协议栈驱动程序和硬盘文件的度量，以保证安全方案的可
实施性。
\par 4.UEFI BIOS中BMC驱动程序的设计。BMC驱动程序是安全方案中度量驱动程序和硬盘文件数据的关键，由他负责取出
存储在BMC芯片中的驱动和文件基准值，来进行度量。BMC驱动分为PEI和DXE阶段两个，文中主要对DXE阶段的BMC驱动介绍
的原因也在于在实验的真机环节中，UEFI启动阶段受到定制，去掉了PEI阶段，只存在DXE阶段的可信度量驱动的加载，但
PEI阶段作为UEFI规范中的一个环节，因此安全方案也对这一阶段做出了设计内容。BMC驱动需要符合IPMI协议，并通过KCS
接口来进行BMC系统的访问，数据的输入和输出流程符合IPMI协议规范以及BMC相关寄存器的使用方法。
\par 5.对安全方案中的关键模块功能进行验证，验证的实验环节也分为真机环节和edk基础版本相同的Windows模拟环境
来进行。其中模拟环境的设置有助于CPU体系结构不相关的功能模块的开发效率，在通过模拟环境的编译和测试后，再进行
真机环境的验证。
\par 综上所述，本方案解决了UEFI系统在加载硬盘文件时容易收到硬盘设备和固件芯片两方面攻击的问题，并给出了UEFI
启动阶段中度量的具体内容和具体方式，保证了UEFI环境中加载硬盘文件的安全可信。但本方案也存在着很多不足之处和
需要进一步改进的地方，在于：
\par 1.目前可信度量的过程在UEFI BIOS环境中完成，但根据可信平台模块的基本功能，度量的过程应由平台模块来进行，
也就是可以改进为通过BIOS发送在固件和硬盘中加载的特定驱动和文件的数据内容，通过BMC驱动发送给BMC中的可信平台
模块，由BMC系统进行度量值的计算和日志生成过程，并将度量结果返回给BIOS，BIOS通过结果来判断下一步的执行安排。
\par 2.目前的度量日志的内容只能通过操作系统中的BMC维护程序来获取，可进一步在UEFI BIOS环境中编写获取BMC系统
中存放的日志内容的功能，可从UEFI SHELL环境中获取日志信息，使功能更加完善。

\end{APP}

\bjutclearpage