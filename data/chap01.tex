%
% 第一章
%
\chapter{绪论}
%
% 2.1节
%
\section{研究背景及意义}
目前，在计算机应用领域，统一可扩展固件接口UEFI（Unified Extensible Firmware Interface）
已经成为了主流基础输入输出系统BIOS（Basic Input/Output System）实现方式并
逐渐取代了传统BIOS，作为一个越来越成熟的BIOS系统，UEFI环境就包括了对硬盘文件加载和运行的功能，其中包括：在调试
关键驱动程序时，可能需要把驱动文件放入硬盘并在UEFI SHELL环境中手动加载\cite{english16,english20}；
操作系统启动需要经过UEFI环境，并在其中加载硬盘中
的操作系统引导程序完成启动，也包括UEFI远程安装并启动操作系统的功能\cite{chinese29}。
在UEFI初始化完成后，可完整使用UEFI提供的系统功能，其中就包括了硬盘中的可扩展固件接口
文件系统分区ESP（Efi system partition）分区数据操作。这块UEFI可访问到的硬盘空间上会存储一些UEFI编译
过程中重要的可扩展固件接口
可执行文件.efi文件，其中就包括了操作系统启动引导文件start\_kernel.efi这样的关键文件\cite{chinese18}，
因此如何在UEFI环境中安全的加载硬盘设备文件就成了关键问题。
\par 因为在UEFI环境下访问硬盘文件，所以这些文件存在通过硬盘被篡改和通过UEFI文件系统被篡改的可能性
\cite{chinese16}。现有技术中有针
对硬盘文件的硬件攻击方法\cite{english5}，通过硬件手段修改硬盘中关键文件的内容起到注入木马程序的效果。
还有一种现有技术中针对存
放BIOS程序的闪存flash芯片提出了一种攻击手段，其攻击原理为通过硬件手段和flash中数据存储格式，修改flash
芯片中的驱动程序内容起到注入木马程序的效果。因为UEFI中访问硬盘文件需要经过UEFI文件系统协议栈，因此通过现有技
术手段可修改协议栈相关驱动\cite{english3}，从UEFI固件层面达到攻击效果。因此对于BIOS固件层面的块设备文件
系统的可信验证是极其具有必要性的\cite{english17,english6,english7}。

%
% 2.2节
%
\section{国内外研究现状}
房强等在“基于固件文件系统的UEFI安全机制研究”一文中通过对UEFI安全威胁研究的分析与总结\cite{chinese11}，提出了基于可信平台模块TPM
（下同）的静态度量固件文件系统中驱动程序的方法。该方案以TPM为可信锚点，此信任根可根据如基板管理控制器BMC（下同）
这样的底层硬件进行替代和改进；其次对于固件文件系统FFS（下同）中的驱动文件度量为静态度量过程，及在UEFI初始化阶段
结束后再进行度量，这样就无法保证初始化过程中的安全性。段晨辉等在“UEFI BIOS安全增强机制及完整性度量的研究“
\cite{chinese8}一文中
通过对UEFI启动阶段中信任链的设计和底层基于可信计算组织TCG（下同）的可信链构建方案，提出了在UEFI完整启动阶段过程
中通过逐个阶段度量后面阶段的内容起到可信启动的效果。但该方案在整个度量过程中需要涉及到驱动加载准备阶段PEI阶段
（下同）核心代码、所有PEI模块程序、驱动加载阶段DXE（下同）核心代码、DXE调度器代码、所有DXE驱动程序代码的度量
工作，缺少对于特定如硬盘设备文件的文件系统的针对性安全验证，并且整个度量过程繁琐耗时，虽然做到了动态度量效果，
但具有相当大的局限性，可行性不高。
\par 文献\mcite{chineses36}提出了一种通过
UEFI固件层面的文件安全存储策略，来保证硬盘文件受到攻击和恶意篡改时可通过BIOS固件中的文件信息进行复原。但是该
专利忽略了对于固件硬件平台的攻击可能性，无法保证固件中备份文件的安全性，即文件的硬件安全防护能力并不突出。
文献\mcite{chineses35}提出了一种通过检测硬盘设备是否安
全可信的机制完成硬盘文件的安全加载。但是该方案忽略了通过篡改BIOS固件中文件系统相关驱动达到修改硬盘文件的手段，
一旦固件中的文件系统被恶意篡改，在UEFI环境中加载硬盘文件不存在可信而言。
\par 在UEFI安全领域\cite{english9,english10,english11}，
大部分基于UEFI的文件加载方案，没有对固件层面的UEFI文件系统驱动可信度量的过程，无法保证固件层面针对硬盘文件
内容的攻击。一些完整性度量方案中着重度量系统的全部信息，缺少一些针对性的驱动内容的度量工作\cite{english4}。
\par 现有研究中也有通过USB Key的方式存储操作系统引导文件\cite{english15}，避免了计算机硬盘被攻击的可能，
但USB设备仍然属于块设备硬件，也存在被攻击的风险。UEFI系统的可信启动也成了近年来重点研究的对象\cite{english8,english14}
，从UEFI启动的各个阶段逐一度量后一阶段然后进行控制权的传递。随着国产化的流行\cite{english19}，同时也为了
适应各种国产硬件如CPU等设备的适配，UEFI的国产化研究适配工作也急需进行。

%
% 2.3节
%
\section{主要研究内容}
鉴于UEFI是BIOS系统的一种统一可扩展标准和方案，拥有着模块化的系统部件添加结构，使他成为BIOS功能开发的首选方案，
目前市场上的BIOS实现也越来越多的统一使用UEFI。与此同时，UEFI BIOS作为计算机启动到加载操作系统的一个中间阶段，
需要在系统启动时加载硬盘中ESP分区中的操作系统引导程序；并且随着UEFI BIOS的功能的不断发展，UEFI BIOS环境中甚至
能够播放视频音频，而硬盘设备又是计算机中数据的主要存储介质，这就增加了BIOS与硬盘设备之间交互频率\cite{chinese10}，BIOS环境中
加载硬盘设备文件的安全性就显得更加重要。因此研究基于UEFI的硬盘设备文件加载的安全机制就具有重要意义。
\par 本文主要研究内容如下：
\par (1)针对UEFI BIOS系统加载硬盘文件过程中存在的安全威胁，通过研究硬盘设备用于存放UEFI BIOS环境中可访问数据的
ESP分区的组织结构，研究UEFI BIOS环境中读取硬盘文件的方式，以及研究以UEFI型驱动程序作为基础的可信度量机制，以此
确保针对硬盘设备攻击的文件安全性。结合可信计算理论提出基于UEFI的硬盘设备文件可信加载的总体框架，并使用的底层可信
平台BMC及基板管理控制器，研究UEFI BIOS中BMC驱动程序的实现原理及具体
过程，研究UEFI BIOS和BMC如何通过基础驱动程序构建安全方案中取得基准值及度量报告的写入方法，以此确保BMC作为本
系统安全方案的可信平台为UEFI提供服务，研究解决UEFI BIOS环境加载硬盘文件过程中的安全可信。
\par (2)针对UEFI BIOS系统加载UEFI BIOS存储闪存设备中的驱动文件过程中存在的安全问题，研究作为UEFI BIOS中最为
关键的系统组件UEFI驱动程序在闪存介质中的数据存储格式，研究PEI和DXE两个加载UEFI驱动程序的主要启动阶段的具体驱动
加载流程和原理，研究可信度量功能在这两个主要阶段中的构建位置。以此确保针对BIOS闪存攻击硬盘文件系统程序（以达到
在BIOS加载硬盘文件时篡改文件内容的目的）过程的安全性。
\par (3)针对安全方案中的驱动加载、度量和日志存储功能，研究UEFI环境下DXE阶段的依赖表达式，来达到修改驱动加载顺序
以保证在被度量驱动加载前加载可信度量驱动程序的目的。研究申威真机环境下通过IO端口映射的方式向BMC发送度量日志，
并且根据UEFI规范找到匹配特定驱动并对其进行度量的方法。
\par (4)根据本系统安全方案的设计，在申威真机平台和Windows模拟环境中分别对驱动度量模块、日志生成功能和驱动加载
顺序修改功能进行实现和测试，以保证功能开发过程的有效性和安全方案的可实施性。

%
% 2.4节
%
\section{本文组织结构}
全文结构一共分为六大部分，各部分内容如下：
\begin{itemize}
\item 第一章\quad 绪论
\par 首先对本文的研究背景和研究意义进行了介绍，然后阐述了现有的UEFI环境下硬盘文件保护方法的
现状及本系统在这个基础上做的改进。介绍了本文的主要研究内容，最后介绍了本文的组织结构。
\item 第二章\quad 相关知识及技术介绍
\par 首先对UEFI BIOS及可扩展固件接口标准的基础输入输出系统的整体设计和层次结构进行了介绍，包括
启动流程、协议加载方式、数据库句柄及固件文件系统数据存储格式。其次对UEFI文件系统协议栈及涉及到的具体
驱动程序做了进一步说明。然后介绍了BMC及基板控制管理器的基本功能及与BIOS通信方式。最后介绍了可信计算技术
的现状及发展。
\item 第三章\quad 基于UEFI的硬盘文件安全加载策略总体设计
\par 首先对UEFI环境中加载硬盘文件的安全漏洞进行了分析，其次介绍了此系统中信任链的涉及与传递，
然后介绍了系统的总体架构设计，包括了DXE和运行时两个主要的度量阶段。最后介绍了此系统的功能模块划分。
\item 第四章\quad 基于UEFI的硬盘文件安全加载策略详细设计
\par 分别对度量计算模块、硬盘文件度量模块、驱动文件度量模块、固件和硬盘访问模块、
BMC通信模块给出了具体设计和关键代码实例，并对SEC、PEI和DXE阶段做了补充说明。
\item 第五章\quad 硬盘文件可信加载方案实现及测试
\par 根据此系统的安全方案设计，介绍了如BMC驱动、文件系统相关驱动的实现、实验及测试过程，以及实验相关的编译
运行环境。通过实验说明了安全方案的可实施性和此系统的预防效果。
\item 结论
\par 对本文的相关研究工作进行了总结和分析，并根据功能测试结果指出本方案的不足之处。并提出了下
一步的研究方向。
\end{itemize}
